<script setup>
import '../../assets/css/components/inputs/_settings.scss';
import Popin from '../utils/Popin.vue';
import { useI18n } from 'vue-i18n';
import Range from './Range.vue';
import { reactive, ref, watch } from 'vue';
import { useSettingsStore } from '../../stores/settings.js';

const { t } = useI18n();
const settingsStore = useSettingsStore();
const { settings, updateSettings } = settingsStore;
const soundAttributes = reactive({
  min: 0,
  max: 100,
  step: 1,
  value: settings.soundVolume * 100,
});
const musicAttributes = reactive({
  min: 0,
  max: 100,
  step: 1,
  value: settings.musicVolume * 100,
});

function updateSound(value) {
  soundAttributes.value = value;
  updateSettings({ soundVolume: value / 100 });
}

function updateMusic(value) {
  musicAttributes.value = value;
  updateSettings({ musicVolume: value / 100 });
}

watch(settings, (value) => {
  if (value.soundVolume) {
    soundAttributes.value = value.soundVolume * 100;
  } else if (value.musicVolume) {
    musicAttributes.value = value.musicVolume * 100;
  }
});
</script>

<template>
  <button class="settings" popovertarget="settings">
    <svg
      class="settings__icon"
      xmlns="http://www.w3.org/2000/svg"
      width="50"
      height="50"
      viewBox="0 0 50 50"
      fill="none"
    >
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M29.9835 1.43081C30.1841 1.84148 30.2362 2.36218 30.3403 3.40359L30.3403 3.40362C30.5374 5.37422 30.6359 6.35953 31.0299 6.91178C31.5961 7.70526 32.565 8.10661 33.5264 7.94583C34.1955 7.83394 34.9619 7.2069 36.4946 5.95281C37.3046 5.29009 37.7096 4.95872 38.1419 4.81018C38.7617 4.59715 39.4397 4.63097 40.0353 4.90461C40.4506 5.09543 40.8206 5.46545 41.5606 6.20548L43.7943 8.43916C44.5344 9.17923 44.9044 9.54926 45.0952 9.96458C45.3689 10.5601 45.4027 11.2381 45.1897 11.858C45.0411 12.2902 44.7098 12.6952 44.047 13.5053L44.047 13.5053C42.7929 15.0381 42.1658 15.8045 42.0539 16.4736C41.8932 17.435 42.2945 18.4039 43.0879 18.97C43.6402 19.364 44.6256 19.4626 46.5963 19.6596C47.6378 19.7638 48.1586 19.8159 48.5693 20.0165C49.1581 20.3041 49.6136 20.8075 49.8412 21.422C50 21.8506 50 22.374 50 23.4206V26.5797C50 27.6261 50 28.1492 49.8413 28.5777C49.6137 29.1925 49.1581 29.696 48.569 29.9836C48.1584 30.1842 47.6378 30.2362 46.5966 30.3403C44.6265 30.5374 43.6415 30.6359 43.0893 31.0296C42.2955 31.5958 41.894 32.5651 42.055 33.5268C42.167 34.1956 42.7938 34.9617 44.0474 36.494C44.7099 37.3037 45.0412 37.7086 45.1897 38.1406C45.4029 38.7606 45.3691 39.4389 45.0953 40.0346C44.9045 40.4498 44.5346 40.8197 43.7948 41.5594L41.5608 43.7934C40.8208 44.5335 40.4508 44.9035 40.0355 45.0943C39.4399 45.3679 38.7619 45.4017 38.142 45.1887C37.7098 45.0402 37.3048 44.7088 36.4948 44.0461L36.4948 44.0461C34.962 42.792 34.1956 42.1649 33.5265 42.053C32.5651 41.8923 31.5962 42.2936 31.0301 43.0871C30.636 43.6393 30.5375 44.6248 30.3404 46.5958C30.2362 47.6377 30.1841 48.1587 29.9834 48.5695C29.6958 49.1581 29.1926 49.6135 28.5782 49.8412C28.1495 50 27.626 50 26.5791 50H23.4206C22.3739 50 21.8506 50 21.422 49.8412C20.8074 49.6136 20.3041 49.1581 20.0164 48.5692C19.8158 48.1585 19.7638 47.6378 19.6596 46.5964C19.4625 44.6256 19.364 43.6402 18.9699 43.0879C18.4038 42.2945 17.435 41.8932 16.4737 42.054C15.8045 42.1658 15.038 42.7929 13.5051 44.0471C12.6951 44.7099 12.29 45.0413 11.8577 45.1899C11.238 45.4028 10.56 45.369 9.96446 45.0954C9.54911 44.9046 9.17905 44.5346 8.43895 43.7945L6.20536 41.5609C5.46528 40.8208 5.09524 40.4508 4.90442 40.0354C4.63081 39.4399 4.59699 38.7619 4.80999 38.1421C4.95854 37.7098 5.28993 37.3048 5.9527 36.4947C7.20683 34.9619 7.83389 34.1955 7.94579 33.5264C8.10656 32.565 7.70521 31.5961 6.91173 31.03C6.35948 30.636 5.37418 30.5374 3.40357 30.3404H3.40356H3.40354C2.36217 30.2362 1.84149 30.1842 1.43082 29.9836C0.841906 29.6959 0.386365 29.1925 0.158735 28.5779C0 28.1493 0 27.626 0 26.5795V23.4209C0 22.374 0 21.8505 0.158828 21.4218C0.386458 20.8074 0.841862 20.3042 1.43058 20.0166C1.84135 19.8159 2.36219 19.7638 3.40387 19.6596H3.40388C5.37509 19.4625 6.36069 19.3639 6.91305 18.9697C7.70622 18.4036 8.10743 17.435 7.94685 16.4739C7.83502 15.8046 7.20775 15.0379 5.95319 13.5046C5.29013 12.6941 4.9586 12.2889 4.81005 11.8565C4.59722 11.2369 4.63102 10.5591 4.90445 9.96379C5.09529 9.54828 5.46547 9.17809 6.20583 8.43773L8.43914 6.20442C9.17923 5.46434 9.54928 5.09429 9.96461 4.90347C10.5601 4.62986 11.2381 4.59605 11.8579 4.80904C12.2902 4.95759 12.6953 5.28903 13.5055 5.95191C15.0381 7.20588 15.8044 7.83287 16.4733 7.94482C17.4349 8.10577 18.4042 7.70431 18.9703 6.91054C19.3641 6.35839 19.4626 5.37334 19.6596 3.40326L19.6597 3.40322C19.7638 2.36215 19.8158 1.84161 20.0163 1.43104C20.304 0.841946 20.8075 0.386281 21.4223 0.158651C21.8508 0 22.3739 0 23.4202 0H26.5794C27.626 0 28.1493 0 28.5779 0.15874C29.1925 0.38637 29.6959 0.841904 29.9835 1.43081ZM25.0001 35C30.5229 35 35.0001 30.5228 35.0001 25C35.0001 19.4771 30.5229 15 25.0001 15C19.4772 15 15.0001 19.4771 15.0001 25C15.0001 30.5228 19.4772 35 25.0001 35Z"
        fill="#FDF1ED"
      />
    </svg>
  </button>
  <Popin id="settings" :title="t('settings')">
    <ul class="popin__list">
      <li class="popin__range">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="27"
          height="36"
          viewBox="0 0 27 36"
          fill="none"
        >
          <path
            d="M2.21419 21.418C0.84752 19.0947 0.847519 16.2131 2.21419 13.8898C2.64094 13.1643 3.35551 12.654 4.18022 12.4857L7.39177 11.8306C7.58614 11.7909 7.76086 11.6854 7.88637 11.5317L11.7388 6.81639C14.0618 3.97304 15.2233 2.55136 16.2655 2.92297C17.3077 3.29458 17.3077 5.13041 17.3077 8.80206L17.3077 26.5057C17.3077 30.1774 17.3077 32.0132 16.2655 32.3848C15.2233 32.7564 14.0618 31.3347 11.7388 28.4914L7.88637 23.776C7.76086 23.6224 7.58614 23.5169 7.39177 23.4772L4.18022 22.822C3.35551 22.6538 2.64094 22.1435 2.21419 21.418Z"
            fill="#1A120F"
          />
          <path
            d="M22.1838 10.7187C23.9777 12.5485 24.99 15.0274 25 17.6151C25.01 20.2029 24.0169 22.6898 22.2371 24.534"
            stroke="#1A120F"
            stroke-width="3.92308"
            stroke-linecap="round"
          />
        </svg>
        <Range @input="updateSound($event)" :attributes="soundAttributes" />
      </li>
      <li class="popin__range">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="29"
          height="37"
          viewBox="0 0 29 37"
          fill="none"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M15.8737 27.9264V22.7869H8.06623C5.04814 22.7869 2.48933 25.0062 2.06251 27.9939C1.49698 31.9526 4.85046 35.3654 8.81846 34.8694L9.85941 34.7393C13.2953 34.3098 15.8737 31.3891 15.8737 27.9264Z"
            fill="#1A120F"
          />
          <path
            d="M15.8737 11.5863V10.4448C15.8737 7.42374 15.8737 5.91321 16.7585 4.86877C17.6433 3.82433 19.1333 3.576 22.1132 3.07934L26.5126 2.3461C26.7662 2.30385 26.8929 2.28272 26.9613 2.3568C27.0297 2.43089 26.9986 2.55558 26.9362 2.80493L25.2649 9.49034C25.237 9.60174 25.2231 9.65744 25.1839 9.69478C25.1448 9.73211 25.0885 9.74337 24.9759 9.76589L15.8737 11.5863ZM15.8737 11.5863V22.7869M15.8737 22.7869V27.9264C15.8737 31.3891 13.2953 34.3098 9.85941 34.7393L8.81846 34.8694C4.85046 35.3654 1.49698 31.9526 2.06251 27.9939C2.48933 25.0062 5.04814 22.7869 8.06623 22.7869H15.8737Z"
            stroke="#1A120F"
            stroke-width="3.73353"
          />
        </svg>
        <Range @input="updateMusic($event)" :attributes="musicAttributes" />
      </li>
    </ul>
  </Popin>
</template>
